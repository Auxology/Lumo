services:
  jaeger:
    image: jaegertracing/jaeger:${JAEGER_VERSION:-latest}
    container_name: lumo-jaeger
    ports:
      - "${JAEGER_OTLP_GRPC_PORT:-4317}:4317"
      - "${JAEGER_OTLP_HTTP_PORT:-4318}:4318"
      - "${JAEGER_UI_PORT:-16686}:16686"
      - "${JAEGER_THRIFT_COMPACT_PORT:-6831}:6831/udp"
    volumes:
      - jaeger-data:/badger
    networks:
      - lumo-network
    restart: unless-stopped
    environment:
      # OTLP Collector
      - COLLECTOR_OTLP_ENABLED=${JAEGER_OTLP_ENABLED:-true}

      # Storage Configuration
      - SPAN_STORAGE_TYPE=${JAEGER_STORAGE_TYPE:-badger}
      - BADGER_EPHEMERAL=${JAEGER_BADGER_EPHEMERAL:-false}
      - BADGER_DIRECTORY_VALUE=/badger/data
      - BADGER_DIRECTORY_KEY=/badger/key

      # Memory & Performance
      - MEMORY_MAX_TRACES=${JAEGER_MAX_TRACES:-50000}

      # Logging
      - LOG_LEVEL=${JAEGER_LOG_LEVEL:-info}
    deploy:
      resources:
        limits:
          memory: ${JAEGER_MEMORY_LIMIT:-512M}
        reservations:
          memory: ${JAEGER_MEMORY_RESERVATION:-256M}
    labels:
      - "lumo.service=jaeger"
      - "lumo.tier=observability"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:16686/"]
      interval: ${JAEGER_HEALTHCHECK_INTERVAL:-10s}
      timeout: ${JAEGER_HEALTHCHECK_TIMEOUT:-5s}
      retries: ${JAEGER_HEALTHCHECK_RETRIES:-5}
      start_period: ${JAEGER_HEALTHCHECK_START_PERIOD:-15s}
