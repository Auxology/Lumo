services:
  seq:
    image: datalust/seq:${SEQ_VERSION:-2024.3}
    container_name: lumo-seq
    ports:
      - "${SEQ_INGESTION_PORT:-5341}:5341"
      - "${SEQ_UI_PORT:-8081}:80"
    volumes:
      - seq-data:/data
    networks:
      - lumo-network
    restart: unless-stopped
    environment:
      # License
      - ACCEPT_EULA=Y

      # Performance & Caching
      - SEQ_CACHE_SYSTEMRAMTARGET=${SEQ_CACHE_RAM_TARGET:-256}

      # Authentication (disable for development)
      - SEQ_FIRSTRUN_NOAUTHENTICATION=${SEQ_FIRSTRUN_NOAUTHENTICATION:-true}
      # API Key (optional - for secure ingestion)
      - SEQ_FIRSTRUN_ADMINPASSWORDHASH=${SEQ_ADMIN_PASSWORD_HASH:-}
    deploy:
      resources:
        limits:
          memory: ${SEQ_MEMORY_LIMIT:-512M}
        reservations:
          memory: ${SEQ_MEMORY_RESERVATION:-256M}
    labels:
      - "lumo.service=seq"
      - "lumo.tier=observability"
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:80/api"]
      interval: ${SEQ_HEALTHCHECK_INTERVAL:-10s}
      timeout: ${SEQ_HEALTHCHECK_TIMEOUT:-5s}
      retries: ${SEQ_HEALTHCHECK_RETRIES:-5}
      start_period: ${SEQ_HEALTHCHECK_START_PERIOD:-15s}

